trigger: none

stages:
  - stage: Build
    jobs:
      - job: BuildJob
        pool: Mera pool
        steps:
          - task: PowerShell@2
            inputs:
              targetType: 'inline'
              script: 'mvn clean package'
              workingDirectory: '$(System.DefaultWorkingDirectory)'

          - task: PublishPipelineArtifact@1
            inputs:
              targetPath: '$(Pipeline.Workspace)'
              artifact: 'java-artifact'
              publishLocation: 'pipeline'

  - stage: Deploy
    jobs:
      - deployment: JavaApplication
        environment:
          name: sidEnv
          resourceType: virtualMachine
        strategy:
          runOnce:
            deploy:
              steps:
                - task: DownloadPipelineArtifact@2
                  inputs:
                    buildType: 'current'
                    artifactName: 'java-artifact'
                    targetPath: '$(Pipeline.Workspace)/artifact'

                - task: Bash@3
                  inputs:
                    targetType: 'inline'
                    script: 'sudo cp $(Pipeline.Workspace)/artifact/java-artifact/s/target/JavaLoginShowcase-1.0.0.war /opt/tomcat/webapps/'

